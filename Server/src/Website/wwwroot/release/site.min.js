window.huypq=window.huypq||{},window.huypq.dateTimeUtils=function(){function e(){var e=new Date;return e.setHours(0,0,0,0),e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}var t={getCurrentDate:e};return t}(),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq_DEBUG===!0&&(window.huypq.log=console.log),window.huypq.control.utilsDOM=function(){function e(e,t,o,i,a){var r=document.createElement(e);for(var l in t)r.setAttribute(l,t[l]);if(void 0!==o&&r.setAttribute("data-bind",o),void 0!==i){var d=document.createTextNode(i);r.appendChild(d)}return void 0!==a&&n(r,a),r}function t(e){return document.createComment(e)}function n(e,t){void 0!==t&&e.classList.add(t)}function o(e,t){var n=$(e).offset().top,o=$(e).height(),i=$(t).offset().top,a=$(t).height();n>i?$(e).scrollTop($(e).scrollTop()-(n-i)):i+a>n+o&&$(e).scrollTop($(e).scrollTop()+(i+a-(n+o)))}var i={createElement:e,createComment:t,addClass:n,scrollToViewElement:o};return i}(),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq.control.headerMenu=function(){function e(e,o){var i=window.huypq.control.utilsDOM.createElement("div",{id:e}),a=t(e+"Large");i.appendChild(a);var r=n(e+"Mobile");return i.appendChild(r),ko.applyBindings(o,i),i}function t(e){var t=window.huypq.control.utilsDOM.createElement("div",{id:e}),n=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: items"),o=window.huypq.control.utilsDOM.createElement("li"),i=window.huypq.control.utilsDOM.createElement("a",{},"attr: {'data-item': value, id: id},\r\n            click: function(){\r\n                $parent.selectedItemValue($data.value);\r\n                $parent.selectedItemText($data.text);\r\n            },\r\n            css: {selected: $parent.selectedItemValue() === value},\r\n            text: text",void 0,"menuItem");return o.appendChild(i),n.appendChild(o),t.appendChild(n),n=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: buttons"),o=window.huypq.control.utilsDOM.createElement("li"),i=window.huypq.control.utilsDOM.createElement("a",{},"attr: {id: id},\r\n            click: action,\r\n            html: text",void 0,"menuButtonItem"),o.appendChild(i),n.appendChild(o),t.appendChild(n),t}function n(e){var t=window.huypq.control.utilsDOM.createElement("div",{id:e}),n=window.huypq.control.utilsDOM.createElement("span",{id:"mobileMenuSelectedItem"},"text: selectedItemText");t.appendChild(n);var o=window.huypq.control.utilsDOM.createElement("div",{id:"mobileMenuButton"});$(o).click(function(){$(i).toggle()}),t.appendChild(o),t.appendChild(window.huypq.control.utilsDOM.createComment("ko foreach: buttons")),l=window.huypq.control.utilsDOM.createElement("a",{},"attr: {id: id+'Mobile'},\r\n            click: action,\r\n            html: text",void 0,"mobileMenuButtonItem"),t.appendChild(l),t.appendChild(window.huypq.control.utilsDOM.createComment("/ko"));var i=window.huypq.control.utilsDOM.createElement("div",{id:"mobileMenuWapper"});$(i).hide(),t.appendChild(i);var a=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: items"),r=window.huypq.control.utilsDOM.createElement("li"),l=window.huypq.control.utilsDOM.createElement("a",{},"attr: {'data-item': value, id: id},\r\n            click: function(){\r\n                $parent.selectedItemValue($data.value);\r\n                $parent.selectedItemText($data.text);\r\n                $('#mobileMenuWapper').hide();\r\n            },\r\n            text: text",void 0,"mobileMenuItem");return r.appendChild(l),a.appendChild(r),i.appendChild(a),t}var o={createView:e};return o}(),window.huypq=window.huypq||{},window.huypq.datepickerLog=window.huypq.datepickerLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},function(e){ko.bindingHandlers.datepicker={init:function(t,n,o){var i=o().datepickerOptions||{dateFormat:"dd/mm/yy",showButtonPanel:!0,changeMonth:!0,changeYear:!0};$(t).datepicker(i),e("datepicker options: "+JSON.stringify(i)),ko.utils.registerEventHandler(t,"change",function(){var o=n();date=$(t).datepicker("getDate"),null!==date&&date.setMinutes(date.getMinutes()-date.getTimezoneOffset()),e("INFO","datepicker selected date: "+JSON.stringify(date)),o(date)}),ko.utils.domNodeDisposal.addDisposeCallback(t,function(){$(t).datepicker("destroy")})},update:function(t,n){var o=ko.utils.unwrapObservable(n()),i=$(t).datepicker("getDate");null!==i&&i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),o-i!==0&&($(t).datepicker("setDate",o),e("datepicker update when model changed: "+JSON.stringify(o)))}}}(window.huypq.datepickerLog),window.huypq=window.huypq||{},window.huypq.comboboxLog=window.huypq.comboboxLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},function(e){function t(t,n){function o(){e("fnOnInput: "+this.value),h(this.value),v(b._ul,b._filteredItems),$(this)[0].setCustomValidity(0===b._filteredItems.length?"invalid":"")}function i(){e("fnInputOnBlur"),$(b._listDiv).is(":visible")===!0&&(x=setTimeout(u,300),e("isValid when lostFocus:"+$(this)[0].validity.valid))}function a(t){switch(t.keyCode){case 27:setTimeout(u,100);break;case 9:$(b._listDiv).is(":visible")===!0&&c();break;case 13:$(b._listDiv).is(":visible")===!0&&(c(),$(b._input).select());break;case 38:$(b._listDiv).is(":visible")&&b._selectedItemIndex>0&&p(b._selectedItemIndex-1);break;case 40:b._selectedItemIndex<b._filteredItems.length-1&&p(b._selectedItemIndex+1)}e("onkeydown: "+t.keyCode)}function r(){e("fnButtonOnClick"),clearTimeout(x),$(b._listDiv).is(":visible")?u():(f(void 0),b._filteredItems=b._items,v(b._ul,b._filteredItems)),w()}function l(t){e("fnSetSelectedValue");var n=$(b._input).val();if("undefined"==typeof t&&"undefined"!=typeof n)return f(void 0),void(b._filteredItems=b._items);for(var o=[],i=0;i<b._items.length;i++){var a=y(b._items[i]);a===t&&o.push(b._items[i])}0!==o.length&&(f(g(o[0])),b._filteredItems=o)}function d(n){e("fnSetItems"),f(void 0),b._items=n,t._setSelectedValue(t._selectedValue)}function u(){e("cancelChangeAndHideList"),b._filteredItems=[];for(var t=0;t<b._items.length;t++){var n=y(b._items[t]);n===b._selectedValue&&b._filteredItems.push(b._items[t])}f(g(b._filteredItems[0])),s()}function c(){e("setValueAndHideList");var o=b._filteredItems[b._selectedItemIndex],i=g(o);f(i),h(i);var a=n.get("cbSelectedValue");t._selectedValue=y(o),a(t._selectedValue),s()}function p(t){e("highlightItem"),$(b._ul).children().eq(b._selectedItemIndex).removeClass("h-boundlist-selected");var n=$(b._ul).children().eq(t);n.addClass("h-boundlist-selected"),window.huypq.control.utilsDOM.scrollToViewElement(b._listDiv,n),b._selectedItemIndex=t}function s(){e("hideList"),clearTimeout(x),$(b._listDiv).hide(),$(b._ul).empty()}function w(){$(b._input).focus(),$(b._input).select()}function m(t){e("selectItem:"+t.innerText),p(t._index),c(),w()}function h(t){e("filterItems"),b._filteredItems=[];for(var n=0;n<b._items.length;n++)0==g(b._items[n]).search(new RegExp(t.replace("\\","\\\\"),"i"))&&b._filteredItems.push(b._items[n])}function v(t,n){e("renderItems"),$(b._ul).empty();for(var o=0;o<n.length;o++){var i=window.huypq.control.utilsDOM.createElement("li",{},void 0,g(n[o]));i._index=o,i.onclick=function(){e("li onclick"),m(this)},i.ontouchstart=function(){e("li ontouchstart"),I=setTimeout(m.bind(null,this),300)},i.ontouchmove=function(){e("li ontouchmove"),clearTimeout(I)},i.onmouseover=function(){e("li onmouseover"),p(this._index)},t.appendChild(i)}$(b._listDiv).show(),p(0)}function f(t){e("setInputText: "+t),$(b._input).val(t)}function g(e){if(n.has("cbItemText")){var t=n.get("cbItemText");if(void 0===e)return void 0;var o=ko.unwrap(e);return o[t]}return ko.unwrap(e)}function y(e){if(n.has("cbItemValue")){var t=n.get("cbItemValue");if(void 0===e)return void 0;var o=ko.unwrap(e);return o[t]}return ko.unwrap(e)}e("initComboBox");var b=t;b._listDiv={},b._input={},b._items=[],b._filteredItems=[],b._ul={},b._selectedItemIndex=-1,b._selectedValue=void 0,b._setItems=d,b._setSelectedValue=l,$(b).addClass("h-comboBox");var _=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-wrapper"),k=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-input-wrapper");b._input=window.huypq.control.utilsDOM.createElement("input",{type:"text"});var M=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-button-wrapper");b._button=window.huypq.control.utilsDOM.createElement("button",{tabindex:-1},void 0,"â–¼"),b._listDiv=window.huypq.control.utilsDOM.createElement("div",{style:"display:none;"},void 0,void 0,"h-boundlist-wrapper"),b._ul=window.huypq.control.utilsDOM.createElement("ul",{}),k.appendChild(b._input),_.appendChild(k),M.appendChild(b._button),_.appendChild(M),b.appendChild(_),b._listDiv.appendChild(b._ul),b.appendChild(b._listDiv);var x,I;b._input.onkeydown=a,b._input.oninput=o,b._input.onblur=i,b._button.onclick=r}ko.bindingHandlers.cbSelectedValue={after:["cbItems"],update:function(t,n,o,i,a){var r=ko.unwrap(n());t._selectedValue!==r&&(t._selectedValue=r,t._setSelectedValue(r),e("INFO","cbSelectedValue update: "+o.get("cbItemText")+" "+JSON.stringify(r)))}},ko.bindingHandlers.cbItems={init:function(n,o,i,a,r){e("cbItems init"),t(n,i)},update:function(t,n,o,i,a){e("cbItems update"),t._setItems(ko.unwrap(n()))}}}(window.huypq.comboboxLog),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq.control.dataGridLog=window.huypq.control.dataGridLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},window.huypq.control.dataGrid=function(e){function t(t,n){function o(t){if(t._isSkipLoadFunction!==!0){var n={};n.whereOptions=[];for(var o=0;o<t._columns.length;o++){var a=t._columns[o],r=ko.unwrap(a.filterValue);void 0!==r&&n.whereOptions.push({$type:a.whereType,predicate:"=",propertyPath:a.cellValueProperty,value:r})}for(var o=0;o<t._customFilter.length;o++){var a=t._customFilter[o],r=ko.unwrap(a.filterValue);void 0!==r&&n.whereOptions.push({$type:a.whereType,predicate:"=",propertyPath:a.propertyPath,value:r})}n.orderOptions=[];for(var o=0;o<t._columns.length;o++){var a=t._columns[o];1===a.order?n.orderOptions.push({propertyPath:a.cellValueProperty,isAscending:!0}):-1===a.order&&n.orderOptions.push({propertyPath:a.cellValueProperty,isAscending:!1})}n.pageIndex=t.paging.currentPageIndex(),t._dataProvider.getItemsAjax(n,function(n){for(var o=0;o<n.items.length;o++){var a=n.items[o];a.isSelected=ko.observable(!1);for(var r=0;r<t._columns.length;r++)t._columns[r].readOnly===!1&&i(a,t._columns[r].cellValueProperty)}for(var l in n.comboBoxItemsSource)t.comboBoxItemsSource[l](n.comboBoxItemsSource[l]);t.items(n.items),t._isSkipLoadFunction=!0,t.paging.pageCount(n.pageCount),t.paging.currentPageIndex(n.pageIndex),t.itemsRemoved=[],t.itemsAdded=[],t._isSkipLoadFunction=!1,e("datagrid loaded")},function(t){e("datagrid getItems error: "+JSON.stringify(t))})}}function i(e,t){e[t].subscribe(function(){e._changed=!0})}function a(t){var n,o,i=[],a=ko.unwrap(t.items);for(n=0;n<a.length;n++)o=a[n],0!==ko.unwrap(t._dataProvider.getItemId(o))&&o._changed===!0&&i.push({state:"u",data:t._dataProvider.toEntity(o)});var r=t.itemsAdded;for(n=0;n<r.length;n++)o=r[n],i.push({state:"a",data:t._dataProvider.toEntity(o)});var l=t.itemsRemoved;for(n=0;n<l.length;n++)o=l[n],i.push({state:"d",data:t._dataProvider.toEntity(o)});e("datagrid changes "+JSON.stringify(i)),t._dataProvider.saveChangesAjax(i,function(o){for(n=0;n<r.length;n++)t._dataProvider.setItemId(t.itemsAdded[n],o[n]);for(t.itemsRemoved=[],t.itemsAdded=[],n=0;n<a.length;n++)a[n]._changed=!1;e("datagrid saved")})}function r(e){for(var t=0;t<e.length;t++){var n=e[t];c._customFilter.push(n),"comboBox"===n.type&&(c.comboBoxItemsSource[n.itemsSourceName]=c.comboBoxItemsSource[n.itemsSourceName]||ko.observableArray()),n.filterValue.subscribe(function(){c._isSkipLoadFunction=!0,c.paging.currentPageIndex(1),c._isSkipLoadFunction=!1,c.load(c)})}}function l(e){c._columns.push(e),"comboBox"===e.type&&(c.comboBoxItemsSource[e.itemsSourceName]=c.comboBoxItemsSource[e.itemsSourceName]||ko.observableArray()),e.filterValue.subscribe(function(){c._isSkipLoadFunction=!0,c.paging.currentPageIndex(1),c._isSkipLoadFunction=!1,c.load(c)})}function d(){return{currentPageIndex:ko.observable(1),pageCount:ko.observable(0),next:function(e){var t=Number(e.paging.currentPageIndex());t<e.paging.pageCount()&&e.paging.currentPageIndex(t+1)},prev:function(e){var t=Number(e.paging.currentPageIndex());t>1&&e.paging.currentPageIndex(t-1)},first:function(e){e.paging.currentPageIndex(1)},last:function(e){e.paging.currentPageIndex(e.paging.pageCount())}}}function u(){var e=0,t="";for(t+="previousSelectedItem:\n",t=t+JSON.stringify(ko.toJS(this.previousSelectedItem))+"\n",t+="currentSelectedItem:\n",t=t+JSON.stringify(ko.toJS(this.currentSelectedItem))+"\n",t+="filters value:\n",e=0;e<this._columns.length;e++)t=t+(e+1)+". "+ko.toJS(this._columns[e].filterValue)+"\n";t+="items:\n";var n=ko.unwrap(this.items);for(e=0;e<n.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(n[e]))+"\n";for(t+="itemsRemoved:\n",e=0;e<this.itemsRemoved.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(this.itemsRemoved[e]))+"\n";for(t+="columns:\n",e=0;e<this._columns.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(this._columns[e]))+"\n";return t}n=n||{hasDeleteButton:!0};var c={items:ko.observableArray(),itemsRemoved:[],itemsAdded:[],comboBoxItemsSource:{},currentSelectedItem:ko.observable(),previousSelectedItem:{},_rowClicked:function(t,n,o){return o.isSelected(!0),void 0!==t.currentSelectedItem()&&t.currentSelectedItem().isSelected(!1),t.previousSelectedItem=ko.unwrap(t.currentSelectedItem),t.currentSelectedItem(o),e("INFO","datagrid selected index: "+n+"item: "+JSON.stringify(ko.toJS(o))),!0},addCustomFilters:r,_customFilter:[],addColumn:l,_columns:[],enablePaging:ko.observable(!0),paging:d(),buttons:[{text:"+",action:function(t){for(var n={},o=1;o<t._columns.length;o++){var i=ko.unwrap(t._columns[o].filterValue);void 0===i&&(i=t._columns[o].defaultValue),n[t._columns[o].cellValueProperty]=ko.observable(i),e(t._columns[o].cellValueProperty+" default value: "+i)}n.isSelected=ko.observable(!1),t.items.push(n),t.itemsAdded.push(n)}},{text:"&#x1f4be;",action:a},{text:"&#8635;",action:o}],_dataProvider:t,_isSkipLoadFunction:!1,load:o,toString:u};return n.hasDeleteButton===!0&&c._columns.push({headerText:"",type:"action",text:"&#xd7;",readOnly:!0,filterValue:ko.observable(),action:function(e,t){if("filter"===t){e._isSkipLoadFunction=!0;for(var n=0;n<e._columns.length;n++)e._columns[n].filterValue(void 0);e._isSkipLoadFunction=!1,e.load(e)}else e.itemsRemoved.push(t),e.items.remove(t)}}),c.paging.currentPageIndex.subscribe(function(){c.load(c)}),c}function n(e,t,n){function o(){var e,t;return e=window.huypq.control.utilsDOM.createElement("div",{},"foreach: _customFilter",void 0,"gridCustomFilter"),t=w(),c(e,t,"value:filterValue","span","input",{}),t=w(),c(e,t,"value:filterValue","textBox","input",{}),t=w(),c(e,t,"checked:filterValue","checkBox","input",{type:"checkbox"}),t=w(),c(e,t,"cbSelectedValue: filterValue, cbItems: $parents[0].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),t=w(),c(e,t,"datepicker:filterValue","date","input",{}),t=w(),u(e,t,"html:text, click: function(data, event) { action($parents[0], 'filter', data, event) }","action","button",{}),t=window.huypq.control.utilsDOM.createElement("div",{},"template: {name: filterTemplate}",void 0,"customFilterCell"),e.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),e.appendChild(t),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),e}function i(){var e=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridHeader"),t=window.huypq.control.utilsDOM.createComment("ko foreach: _columns"),n=window.huypq.control.utilsDOM.createElement("div",{},"css: 'col'+($index()+1)",void 0,"cell"),o=window.huypq.control.utilsDOM.createElement("span",{},"text: headerText"),i=window.huypq.control.utilsDOM.createComment("/ko");return e.appendChild(t),e.appendChild(n),n.appendChild(o),e.appendChild(i),e}function a(){var e,t;return e=window.huypq.control.utilsDOM.createElement("div",{},"foreach: _columns",void 0,"gridColumnFilter"),t=s(),c(e,t,"value:filterValue","span","input",{}),t=s(),c(e,t,"value:filterValue","textBox","input",{}),t=s(),c(e,t,"checked:filterValue","checkBox","input",{type:"checkbox"}),t=s(),c(e,t,"cbSelectedValue: filterValue, cbItems: $parents[0].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),t=s(),c(e,t,"datepicker:filterValue","date","input",{}),t=s(),u(e,t,"html:text, click: function(data, event) { action($parents[0], 'filter', data, event) }","action","button",{}),t=window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' columnFilter', template: {name: filterTemplate}",void 0,"cell"),e.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),e.appendChild(t),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),e}function r(e){var t=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridBody"),n=window.huypq.control.utilsDOM.createComment(" ko foreach: items "),o=window.huypq.control.utilsDOM.createComment(" /ko ");return t.appendChild(n),t.appendChild(d(e)),t.appendChild(o),t}function l(){var e=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridBottomToolbar"),t=window.huypq.control.utilsDOM.createComment("ko with: paging"),n=window.huypq.control.utilsDOM.createElement("input",{type:"checkbox"},"checked: $parent.enablePaging",void 0,void 0),o=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x21e4;', enable: $parent.enablePaging, click: function(data, event){first($parents[0], data, event)}"),i=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x21e5;', enable: $parent.enablePaging, click: function(data, event){last($parents[0], data, event)}"),a=window.huypq.control.utilsDOM.createElement("input",{size:2},"enable: $parent.enablePaging, value: currentPageIndex",void 0,void 0),r=window.huypq.control.utilsDOM.createElement("span",{},"text:'/'+pageCount()",void 0,void 0),l=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x2190;', enable: $parent.enablePaging, click: function(data, event){prev($parents[0], data, event)}"),d=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x2192;', enable: $parent.enablePaging, click: function(data, event){next($parents[0], data, event)}"),u=window.huypq.control.utilsDOM.createComment("/ko"),c=window.huypq.control.utilsDOM.createComment("ko foreach:buttons"),p=window.huypq.control.utilsDOM.createElement("button",{},"html:text, click: function(data, event){action($parents[0], data, event)}"),s=window.huypq.control.utilsDOM.createComment("/ko");return e.appendChild(t),e.appendChild(n),e.appendChild(o),e.appendChild(i),e.appendChild(a),e.appendChild(r),e.appendChild(l),e.appendChild(d),e.appendChild(u),e.appendChild(c),e.appendChild(p),e.appendChild(s),e}function d(e){var t,n;return t="row"===e?window.huypq.control.utilsDOM.createElement("div",{},"click: function(data, event){return $parents[0]._rowClicked($parents[0], $index(), data, event)}, foreach: $parent._columns, css: css() + ' ' + (isSelected()?' selected':'')",void 0,"row"):window.huypq.control.utilsDOM.createElement("div",{},"click: function(data, event){return $parents[0]._rowClicked($parents[0], $index(), data, event)}, foreach: $parent._columns, css: (isSelected()?' selected':'')",void 0,"row"),n=p(),u(t,n,"text:$parent[cellValueProperty]","span","span",{}),n=p(),u(t,n,"textInput:$parent[cellValueProperty], disable:readOnly","textBox","input",{}),n=p(),u(t,n,"checked:$parent[cellValueProperty], disable:readOnly","checkBox","input",{type:"checkbox"}),n=p(),u(t,n,"cbSelectedValue: $parent[cellValueProperty], cbItems: $parents[1].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),n=p(),u(t,n,"datepicker:$parent[cellValueProperty], disable:readOnly","date","input",{}),n=p(),u(t,n,"html:text, click: function(data, event) { action($parents[1], $parent, data, event) }","action","button",{}),n=window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1), template: {name: cellTemplate}",void 0,"cell"),t.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),t.appendChild(n),t.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),t}function u(e,t,n,o,i,a){var r=window.huypq.control.utilsDOM.createElement(i,a,n),l="ko if:type==='{0}'";e.appendChild(window.huypq.control.utilsDOM.createComment(l.replace("{0}",o))),e.appendChild(t),t.appendChild(r),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko"))}function c(e,t,n,o,i,a){var r=window.huypq.control.utilsDOM.createElement(i,a,n),l="ko if:type==='{0}'";e.appendChild(window.huypq.control.utilsDOM.createComment(l.replace("{0}",o)));var d=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-wrapper"),u=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-button-wrapper"),c=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-input-wrapper"),p=window.huypq.control.utilsDOM.createElement("button",{},"click: function(data, event) { data.filterValue(undefined); }","x");u.appendChild(p),c.appendChild(r),d.appendChild(u),d.appendChild(c),e.appendChild(t),t.appendChild(d),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko"))}function p(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + (readOnly?' readonly':'')",void 0,"cell")}function s(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' columnFilter'",void 0,"cell")}function w(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' customFilterCell'",void 0,void 0)}t=t||{hasCustomFilter:!1,hasColumnHeader:!0,hasColumnFilter:!0,hasBottomToolbar:!0};var m=window.huypq.control.utilsDOM.createElement("div",{id:e},void 0,void 0,"h-dataGrid");return t.hasCustomFilter===!0&&m.appendChild(o()),t.hasColumnHeader===!0&&m.appendChild(i()),t.hasColumnFilter===!0&&m.appendChild(a()),m.appendChild(r(n)),t.hasBottomToolbar===!0&&m.appendChild(l()),m}var o={createView:n,createViewModel:t};return o}(window.huypq.control.dataGridLog),window.app={},window.app.dataProvider={},window.app.view={},window.app.viewModel={},window.app.webApiLog=window.app.webApiLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},window.app.webApi=function(e){function t(e,t){return"http://gaucon.net:5000/"+e+"/"+t}function n(e){return t(e,"get")}function o(t,o){var a=n(t);o=o||{};var l=JSON.stringify(o),d=new $.Deferred,u=t+"_"+l;e("webApi cacheKey: "+u);var c=r._cache[u],p=0,s=0;return void 0!==c&&(p=c.versionNumber,s=c.serverStartTime,l=l.length<3?'{"versionNumber":'+p+',"serverStartTime":'+s+"}":'{"versionNumber":'+p+',"serverStartTime":'+s+","+l.substr(1)),i(a,l).done(function(n,o,i){p===n.versionNumber&&s===n.serverStartTime?(e("INFO","webApi cache hit "+t+"   "+p),d.resolve(JSON.parse(c.jsonStringData),c.textStatus,c.jqXHR)):(e("INFO","webApi cache miss "+t+"   "+n.versionNumber),r._cache[u]={serverStartTime:n.serverStartTime,versionNumber:n.versionNumber,jsonStringData:JSON.stringify(n),textStatus:o,jqXHR:i},d.resolve(n,o,i))}).fail(function(e){d.reject(e)}),d}function i(t,n){e("INFO","webApi postJson: "+t+" "+n);var o={dataType:"json",contentType:"application/json",cache:!1,type:"post",data:n},i=window.localStorage.getItem(window.tokenKey);return i&&(o.headers={token:i}),$.ajax(t,o)}function a(t,n){e("INFO","webApi postParams: "+t+" "+JSON.stringify(n));var o={dataType:"json",contentType:"application/x-www-form-urlencoded",cache:!1,type:"post",data:n},i=window.localStorage.getItem(window.tokenKey);return i&&(o.headers={token:i}),$.ajax(t,o)}var r={user:{login:function(e){return a(t("user","login"),e)},accesstoken:function(e){return a(t("user","accesstoken"),e)},getgroups:function(e){return a(t("user","getgroups"),e)}},getData:o,_cache:{}};return r}(window.app.webApiLog),window.app.referenceDataManagerLog=window.app.referenceDataManagerLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},window.app.referenceDataManager=function(e,t){var n={_cache:{}};return n.get=function(o,i){var a=new $.Deferred,r=n._cache[o];return void 0!==r?(t("INFO","referenceDataManager cache hit: "+o),a.resolve(r.data,r.textStatus,r.jqXHR)):e.getData(o,i).done(function(e,i,r){t("INFO","referenceDataManager cache miss: "+o),n._cache[o]={data:e,textStatus:i,jqXHR:r},a.resolve(e,i,r)}).fail(function(e){a.reject(e)}),a},n}(window.app.webApi,window.app.referenceDataManagerLog),window.app.dataProvider.tonKhoDataProvider=function(e,t){function n(n,o,i){n.orderOptions=[{propertyPath:"MaMatHangNavigation.TenMatHangDayDu",isAscending:!0}],n.pageIndex=0,$.when(e.getData("ttonKho",n),t.get("rloaiHang",{orderOptions:[{propertyPath:"TenLoai",isAscending:!0}]}),t.get("tmatHang"),t.get("rkhoHang",{orderOptions:[{propertyPath:"TenKho",isAscending:!0}]}),t.get("rcanhBaoTonKho")).done(function(e,t,n,i,a){for(var r={},l=a[0].items,d=0;d<l.length;d++)r[l[d].maKhoHang]=r[l[d].maKhoHang]||{},r[l[d].maKhoHang][l[d].maMatHang]={tonCaoNhat:l[d].tonCaoNhat,tonThapNhat:l[d].tonThapNhat};for(var u={},c=n[0].items,d=0;d<c.length;d++)u[c[d].ma]=c[d].tenMatHangDayDu;for(var p={items:[],totalItemCount:e[0].TotalItemCount,pageIndex:e[0].PageIndex,pageCount:e[0].PageCount},s=e[0].items,d=0;d<s.length;d++){var w=s[d],m="";if(void 0!==r[w.maKhoHang]&&void 0!==r[w.maKhoHang][w.maMatHang]){var h=r[w.maKhoHang][w.maMatHang],v=w.soLuong;if(0==v&&0==h.tonThapNhat)continue;v<h.tonThapNhat?m="warningLower":v>h.tonCaoNhat&&(m="warningUpper")}p.items.push({tenMatHang:ko.observable(u[w.maMatHang]),soLuong:ko.observable(w.soLuong),css:ko.observable(m)})}p.comboBoxItemsSource={},p.comboBoxItemsSource.loaiHangs=t[0].items,p.comboBoxItemsSource.khoHangs=i[0].items,o(p)}).fail(i)}var o={_items:[],getItemsAjax:n};return o}(window.app.webApi,window.app.referenceDataManager),window.app.viewModel.loginViewModel=function(e){function t(){var t={email:ko.observable("huy"),password:ko.observable(),groupList:ko.observableArray(),group:ko.observable(),loginAction:function(t){e.user.login({user:t.email(),pass:t.password()}).done(function(n){window.localStorage.setItem(window.tokenKey,n),e.user.getgroups({user:t.email()}).done(function(e){for(var n=e.split("*&*"),o=[],i=0;i<n.length-1;i++)o.push({text:n[i]});t.groupList(o),t.group(n[0])}).fail(function(e){console.log("fail: "+JSON.stringify(e))})}).fail(function(e){console.log("fail: "+JSON.stringify(e))})},okAction:function(t){e.user.accesstoken({group:t.group()}).done(function(e){window.localStorage.setItem(window.tokenKey,e),window.app.view.mainView.show()}).fail(function(e){console.log("fail: "+JSON.stringify(e))})}};return t}var n={create:t};return n}(window.app.webApi),window.app.viewModel.tonKhoViewModel=function(){var e=huypq.control.dataGrid.createViewModel(window.app.dataProvider.tonKhoDataProvider,{hasDeleteButton:!1});e.addColumn({headerText:"",type:"span",cellValueProperty:"tenMatHang",readOnly:!1,order:0,filterValue:ko.observable()}),e.addColumn({headerText:"",type:"span",cellValueProperty:"soLuong",readOnly:!1,order:0,filterValue:ko.observable()});var t={tk:1,d:huypq.dateTimeUtils.getCurrentDate(),ml:1},n={type:"comboBox",propertyPath:"MaKhoHang",itemsSourceName:"khoHangs",itemText:"tenKho",itemValue:"ma",filterValue:ko.observable(t.tk),whereType:"QueryBuilder.WhereExpression+WhereOptionInt, QueryBuilder"},o={type:"date",propertyPath:"Ngay",filterValue:ko.observable(t.d),whereType:"QueryBuilder.WhereExpression+WhereOptionDate, QueryBuilder"},i={type:"comboBox",propertyPath:"MaMatHangNavigation.MaLoai",itemsSourceName:"loaiHangs",itemText:"tenLoai",itemValue:"ma",filterValue:ko.observable(t.ml),whereType:"QueryBuilder.WhereExpression+WhereOptionInt, QueryBuilder"};return e.addCustomFilters([n,o,i]),e.init=function(){e.initialized!==!0&&(e.initialized=!0,e.load(e))},e}(),window.app.view.viewManagerLog=window.app.view.viewManagerLog||function(e,t){"INFO"===e?console.log(t):"undefined"!=typeof window.huypq.log&&window.huypq.log(t)},window.app.view.viewManager=function(e){function t(){var e=window.app.view[i._currentViewName](i._currentViewName);$(i._mainContentId).append(e),ko.applyBindings(i._currentViewModel,e)}function n(n){if(void 0!==window.app.view[i._currentViewName]&&$("#"+i._currentViewName).hide(),i._currentViewName=n,e("INFO","viewManager currentViewName: "+i._currentViewName),void 0===window.app.view[i._currentViewName])throw new Error("View not exist: "+i._currentViewName);i._currentViewModel=window.app.viewModel[i._currentViewName+"Model"],(void 0===i._currentViewModel.initialized||i._currentViewModel.initialized===!1)&&(t(),i._currentViewModel.init()),$("#"+i._currentViewName).show(),i._isSkipPushState===!1&&(window.history.pushState({selectedView:n},"","?v="+n),e("pushState: "+JSON.stringify(n)))}function o(e,t){for(var n=-1,o=0;o<t.length;o++){var i=t[o];if(i.value===e){n=o;break}}return n}var i={_headerMenuViewModel:{},_currentViewName:"",_currentViewModel:{},_mainContentId:"",_isSkipPushState:!1};return i.init=function(t,o,a){this._headerMenuViewModel=a,this._mainContentId=o,$(t).append(window.huypq.control.headerMenu.createView("headerMenuView",a)),a.selectedItemValue.subscribe(n),window.onpopstate=function(t){i.setCurrentView(t.state.selectedView),e("onpopstate: "+JSON.stringify(t.state))}},i.setCurrentView=function(e){var t=o(e,this._headerMenuViewModel.items);0>t||(this._isSkipPushState=!0,this._headerMenuViewModel.selectedItemText(this._headerMenuViewModel.items[t].text),this._headerMenuViewModel.selectedItemValue(this._headerMenuViewModel.items[t].value),this._isSkipPushState=!1)},i.loadCurrentView=function(){i._currentViewModel.load(i._currentViewModel)},i}(window.app.view.viewManagerLog),window.app.view.mainView=function(e){function t(){$("#mainView").show(),$("#loginView").hide();var t=window.params.v||"tonKhoView";e.setCurrentView(t)}function n(){var t={items:[{text:"Ton kho",value:"tonKhoView",id:""}],selectedItemText:ko.observable(),selectedItemValue:ko.observable(),buttons:[{text:"",id:"refreshButton",action:function(){e.loadCurrentView()}},{text:"&#x2716;",id:"exitButton",action:function(){window.localStorage.removeItem(window.tokenKey),window.app.view.loginView.show()}}]};e.init("#headerContent","#mainContent",t)}var o={show:t,init:n};return o}(window.app.view.viewManager),window.app.view.loginView=function(e){function t(){$("#loginView").show(),$("#mainView").hide(),i.viewModel.password(void 0),i.viewModel.groupList(void 0),i.viewModel.group(void 0)}function n(){o("#loginView"),i.viewModel=window.app.viewModel.loginViewModel.create(),ko.applyBindings(i.viewModel,$("#loginView")[0])}function o(t){$(t).append(e.createElement("input",{id:"email",type:"text",placeholder:"Email"},"textInput: email")),$(t).append(e.createElement("input",{id:"password",type:"password",placeholder:"Password"},"textInput: password")),$(t).append(e.createElement("button",{},"click: loginAction","Login")),$(t).append(e.createElement("div",{},"cbSelectedValue: group, cbItems: groupList, cbItemText: 'text', cbItemValue: 'text'")),$(t).append(e.createElement("button",{},"click: okAction","Ok"))}var i={show:t,init:n,viewModel:{}};return i}(window.huypq.control.utilsDOM),window.app.view.tonKhoView=function(){return function(e){var t=window.huypq.control.dataGrid.createView(e,{hasCustomFilter:!0,hasColumnHeader:!1,hasColumnFilter:!1,hasBottomToolbar:!1},"row");return t}}(),function(){
{var e=window.huypq.log||function(e){};console.log}$("body").append('<div id="loginView"></div>','<div id="mainView"></div>'),$("#mainView").append('<div id="headerContent"></div>','<div id="mainContent"></div>'),window.tokenKey="accessToken";var t=window.localStorage.getItem(window.tokenKey);e("app token: "+t),window.app.view.mainView.init(),window.app.view.loginView.init(),t?window.app.view.mainView.show():window.app.view.loginView.show()}();