window.huypq=window.huypq||{},window.huypq.dateTimeUtils=function(){function e(){var e=new Date;return e.setHours(0,0,0,0),e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}var t={getCurrentDate:e};return t}(),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq_DEBUG===!0&&(window.huypq.log=console.log),window.huypq.control.utilsDOM=function(){function e(e,t,i,o,a){var r=document.createElement(e);for(var l in t)r.setAttribute(l,t[l]);if(void 0!==i&&r.setAttribute("data-bind",i),void 0!==o){var d=document.createTextNode(o);r.appendChild(d)}return void 0!==a&&n(r,a),r}function t(e){return document.createComment(e)}function n(e,t){void 0!==t&&e.classList.add(t)}function i(e,t){var n=$(e).offset().top,i=$(e).height(),o=$(t).offset().top,a=$(t).height();n>o?$(e).scrollTop($(e).scrollTop()-(n-o)):o+a>n+i&&$(e).scrollTop($(e).scrollTop()+(o+a-(n+i)))}var o={createElement:e,createComment:t,addClass:n,scrollToViewElement:i};return o}(),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq.control.headerMenu=function(){function e(e,i){var o=window.huypq.control.utilsDOM.createElement("div",{id:e}),a=t(e+"Large");o.appendChild(a);var r=n(e+"Mobile");return o.appendChild(r),ko.applyBindings(i,o),o}function t(e){var t=window.huypq.control.utilsDOM.createElement("div",{id:e}),n=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: items"),i=window.huypq.control.utilsDOM.createElement("li"),o=window.huypq.control.utilsDOM.createElement("a",{},"attr: {'data-item': value, id: id},\r\n            click: function(){\r\n                $parent.selectedItemValue($data.value);\r\n                $parent.selectedItemText($data.text);\r\n            },\r\n            css: {selected: $parent.selectedItemValue() === value},\r\n            text: text",void 0,"menuItem");return i.appendChild(o),n.appendChild(i),t.appendChild(n),n=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: buttons"),i=window.huypq.control.utilsDOM.createElement("li"),o=window.huypq.control.utilsDOM.createElement("a",{},"attr: {id: id},\r\n            click: action,\r\n            html: text",void 0,"menuButtonItem"),i.appendChild(o),n.appendChild(i),t.appendChild(n),t}function n(e){var t=window.huypq.control.utilsDOM.createElement("div",{id:e}),n=window.huypq.control.utilsDOM.createElement("span",{id:"mobileMenuSelectedItem"},"text: selectedItemText");t.appendChild(n);var i=window.huypq.control.utilsDOM.createElement("div",{id:"mobileMenuButton"});$(i).click(function(){$(o).toggle()}),t.appendChild(i),t.appendChild(window.huypq.control.utilsDOM.createComment("ko foreach: buttons")),l=window.huypq.control.utilsDOM.createElement("a",{},"attr: {id: id+'Mobile'},\r\n            click: action,\r\n            html: text",void 0,"mobileMenuButtonItem"),t.appendChild(l),t.appendChild(window.huypq.control.utilsDOM.createComment("/ko"));var o=window.huypq.control.utilsDOM.createElement("div",{id:"mobileMenuWapper"});$(o).hide(),t.appendChild(o);var a=window.huypq.control.utilsDOM.createElement("ul",{},"foreach: items"),r=window.huypq.control.utilsDOM.createElement("li"),l=window.huypq.control.utilsDOM.createElement("a",{},"attr: {'data-item': value, id: id},\r\n            click: function(){\r\n                $parent.selectedItemValue($data.value);\r\n                $parent.selectedItemText($data.text);\r\n                $('#mobileMenuWapper').hide();\r\n            },\r\n            text: text",void 0,"mobileMenuItem");return r.appendChild(l),a.appendChild(r),o.appendChild(a),t}var i={createView:e};return i}(),function(){var e=window.huypq.log||function(e){},t=console.log;ko.bindingHandlers.datepicker={init:function(n,i,o){var a=o().datepickerOptions||{dateFormat:"dd/mm/yy",showButtonPanel:!0,changeMonth:!0,changeYear:!0};$(n).datepicker(a),e("datepicker options: "+JSON.stringify(a)),ko.utils.registerEventHandler(n,"change",function(){var e=i();date=$(n).datepicker("getDate"),date.setMinutes(date.getMinutes()-date.getTimezoneOffset()),t("datepicker selected date: "+JSON.stringify(date)),e(date)}),ko.utils.domNodeDisposal.addDisposeCallback(n,function(){$(n).datepicker("destroy")})},update:function(t,n){var i=ko.utils.unwrapObservable(n()),o=$(t).datepicker("getDate");i-o!==0&&($(t).datepicker("setDate",i),e("datepicker update when model changed: "+JSON.stringify(i)))}}}(),window.huypq=window.huypq||{},function(){function e(e,n){function i(){t("fnOnInput: "+this.value),h(this.value),v(b._ul,b._filteredItems),$(this)[0].setCustomValidity(0===b._filteredItems.length?"invalid":"")}function o(){t("fnInputOnBlur"),$(b._listDiv).is(":visible")===!0&&(C=setTimeout(u,300),t("isValid when lostFocus:"+$(this)[0].validity.valid))}function a(e){switch(e.keyCode){case 27:setTimeout(u,100);break;case 9:$(b._listDiv).is(":visible")===!0&&c();break;case 13:$(b._listDiv).is(":visible")===!0&&(c(),$(b._input).select());break;case 38:$(b._listDiv).is(":visible")&&b._selectedItemIndex>0&&s(b._selectedItemIndex-1);break;case 40:b._selectedItemIndex<b._filteredItems.length-1&&s(b._selectedItemIndex+1)}t("onkeydown: "+e.keyCode)}function r(){t("fnButtonOnClick"),clearTimeout(C),$(b._listDiv).is(":visible")?u():(f(void 0),b._filteredItems=b._items,v(b._ul,b._filteredItems)),m()}function l(e){t("fnSetSelectedValue");var n=$(b._input).val();if("undefined"==typeof e&&"undefined"!=typeof n)return f(void 0),void(b._filteredItems=b._items);for(var i=[],o=0;o<b._items.length;o++){var a=y(b._items[o]);a===e&&i.push(b._items[o])}0!==i.length&&(f(g(i[0])),b._filteredItems=i)}function d(n){t("fnSetItems"),f(void 0),b._items=n,e._setSelectedValue(e._selectedValue)}function u(){t("cancelChangeAndHideList"),b._filteredItems=[];for(var e=0;e<b._items.length;e++){var n=y(b._items[e]);n===b._selectedValue&&b._filteredItems.push(b._items[e])}f(g(b._filteredItems[0])),p()}function c(){t("setValueAndHideList");var i=b._filteredItems[b._selectedItemIndex],o=g(i);f(o),h(o);var a=n.get("cbSelectedValue");e._selectedValue=y(i),a(e._selectedValue),p()}function s(e){t("highlightItem"),$(b._ul).children().eq(b._selectedItemIndex).removeClass("h-boundlist-selected");var n=$(b._ul).children().eq(e);n.addClass("h-boundlist-selected"),window.huypq.control.utilsDOM.scrollToViewElement(b._listDiv,n),b._selectedItemIndex=e}function p(){t("hideList"),clearTimeout(C),$(b._listDiv).hide(),$(b._ul).empty()}function m(){$(b._input).focus(),$(b._input).select()}function w(e){t("selectItem:"+e.innerText),s(e._index),c(),m()}function h(e){t("filterItems"),b._filteredItems=[];for(var n=0;n<b._items.length;n++)0==g(b._items[n]).search(new RegExp(e.replace("\\","\\\\"),"i"))&&b._filteredItems.push(b._items[n])}function v(e,n){t("renderItems"),$(b._ul).empty();for(var i=0;i<n.length;i++){var o=window.huypq.control.utilsDOM.createElement("li",{},void 0,g(n[i]));o._index=i,o.onclick=function(){t("li onclick"),w(this)},o.ontouchstart=function(){t("li ontouchstart"),M=setTimeout(w.bind(null,this),300)},o.ontouchmove=function(){t("li ontouchmove"),clearTimeout(M)},o.onmouseover=function(){t("li onmouseover"),s(this._index)},e.appendChild(o)}$(b._listDiv).show(),s(0)}function f(e){t("setInputText: "+e),$(b._input).val(e)}function g(e){if(n.has("cbItemText")){var t=n.get("cbItemText");if(void 0===e)return void 0;var i=ko.unwrap(e);return i[t]}return ko.unwrap(e)}function y(e){if(n.has("cbItemValue")){var t=n.get("cbItemValue");if(void 0===e)return void 0;var i=ko.unwrap(e);return i[t]}return ko.unwrap(e)}t("initComboBox");var b=e;b._listDiv={},b._input={},b._items=[],b._filteredItems=[],b._ul={},b._selectedItemIndex=-1,b._selectedValue=void 0,b._setItems=d,b._setSelectedValue=l,$(b).addClass("h-comboBox");var _=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-wrapper"),k=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-input-wrapper");b._input=window.huypq.control.utilsDOM.createElement("input",{type:"text"});var x=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-button-wrapper");b._button=window.huypq.control.utilsDOM.createElement("button",{tabindex:-1},void 0,"â–¼"),b._listDiv=window.huypq.control.utilsDOM.createElement("div",{style:"display:none;"},void 0,void 0,"h-boundlist-wrapper"),b._ul=window.huypq.control.utilsDOM.createElement("ul",{}),k.appendChild(b._input),_.appendChild(k),x.appendChild(b._button),_.appendChild(x),b.appendChild(_),b._listDiv.appendChild(b._ul),b.appendChild(b._listDiv);var C,M;b._input.onkeydown=a,b._input.oninput=i,b._input.onblur=o,b._button.onclick=r}var t=window.huypq.log||function(e){},n=console.log;ko.bindingHandlers.cbSelectedValue={after:["cbItems"],update:function(e,t,i,o,a){var r=ko.unwrap(t());e._selectedValue!==r&&(e._selectedValue=r,e._setSelectedValue(r),n("cbSelectedValue update: "+i.get("cbItemText")+" "+JSON.stringify(r)))}},ko.bindingHandlers.cbItems={init:function(n,i,o,a,r){t("cbItems init"),e(n,o)},update:function(e,n,i,o,a){t("cbItems update"),e._setItems(ko.unwrap(n()))}}}(),window.huypq=window.huypq||{},window.huypq.control=window.huypq.control||{},window.huypq.control.dataGrid=function(){function e(e,t){function o(e){if(e._isSkipLoadFunction!==!0){var t={};t.whereOptions=[];for(var i=0;i<e._columns.length;i++){var o=e._columns[i],r=ko.unwrap(o.filterValue);void 0!==r&&t.whereOptions.push({$type:o.whereType,predicate:"=",propertyPath:o.cellValueProperty,value:r})}for(var i=0;i<e._customFilter.length;i++){var o=e._customFilter[i],r=ko.unwrap(o.filterValue);void 0!==r&&t.whereOptions.push({$type:o.whereType,predicate:"=",propertyPath:o.propertyPath,value:r})}t.orderOptions=[];for(var i=0;i<e._columns.length;i++){var o=e._columns[i];1===o.order?t.orderOptions.push({propertyPath:o.cellValueProperty,isAscending:!0}):-1===o.order&&t.orderOptions.push({propertyPath:o.cellValueProperty,isAscending:!1})}t.pageIndex=e.paging.currentPageIndex(),e._dataProvider.getItemsAjax(t,function(t){for(var i=0;i<t.items.length;i++){var o=t.items[i];o.isSelected=ko.observable(!1);for(var r=0;r<e._columns.length;r++)e._columns[r].readOnly===!1&&a(o,e._columns[r].cellValueProperty)}for(var l in t.comboBoxItemsSource)e.comboBoxItemsSource[l](t.comboBoxItemsSource[l]);e.items(t.items),e._isSkipLoadFunction=!0,e.paging.pageCount(t.pageCount),e.paging.currentPageIndex(t.pageIndex),e.itemsRemoved=[],e.itemsAdded=[],e._isSkipLoadFunction=!1,n("datagrid loaded")},function(e){n("datagrid getItems error: "+JSON.stringify(e))})}}function a(e,t){e[t].subscribe(function(){e._changed=!0})}function r(e){var t,i,o=[],a=ko.unwrap(e.items);for(t=0;t<a.length;t++)i=a[t],0!==ko.unwrap(e._dataProvider.getItemId(i))&&i._changed===!0&&o.push({state:"u",data:e._dataProvider.toEntity(i)});var r=e.itemsAdded;for(t=0;t<r.length;t++)i=r[t],o.push({state:"a",data:e._dataProvider.toEntity(i)});var l=e.itemsRemoved;for(t=0;t<l.length;t++)i=l[t],o.push({state:"d",data:e._dataProvider.toEntity(i)});n("datagrid changes "+JSON.stringify(o)),e._dataProvider.saveChangesAjax(o,function(i){for(t=0;t<r.length;t++)e._dataProvider.setItemId(e.itemsAdded[t],i[t]);for(e.itemsRemoved=[],e.itemsAdded=[],t=0;t<a.length;t++)a[t]._changed=!1;n("datagrid saved")})}function l(e){for(var t=0;t<e.length;t++){var n=e[t];s._customFilter.push(n),"comboBox"===n.type&&(s.comboBoxItemsSource[n.itemsSourceName]=s.comboBoxItemsSource[n.itemsSourceName]||ko.observableArray()),n.filterValue.subscribe(function(){s._isSkipLoadFunction=!0,s.paging.currentPageIndex(1),s._isSkipLoadFunction=!1,s.load(s)})}}function d(e){s._columns.push(e),"comboBox"===e.type&&(s.comboBoxItemsSource[e.itemsSourceName]=s.comboBoxItemsSource[e.itemsSourceName]||ko.observableArray()),e.filterValue.subscribe(function(){s._isSkipLoadFunction=!0,s.paging.currentPageIndex(1),s._isSkipLoadFunction=!1,s.load(s)})}function u(){return{currentPageIndex:ko.observable(1),pageCount:ko.observable(0),next:function(e){var t=Number(e.paging.currentPageIndex());t<e.paging.pageCount()&&e.paging.currentPageIndex(t+1)},prev:function(e){var t=Number(e.paging.currentPageIndex());t>1&&e.paging.currentPageIndex(t-1)},first:function(e){e.paging.currentPageIndex(1)},last:function(e){e.paging.currentPageIndex(e.paging.pageCount())}}}function c(){var e=0,t="";for(t+="previousSelectedItem:\n",t=t+JSON.stringify(ko.toJS(this.previousSelectedItem))+"\n",t+="currentSelectedItem:\n",t=t+JSON.stringify(ko.toJS(this.currentSelectedItem))+"\n",t+="filters value:\n",e=0;e<this._columns.length;e++)t=t+(e+1)+". "+ko.toJS(this._columns[e].filterValue)+"\n";t+="items:\n";var n=ko.unwrap(this.items);for(e=0;e<n.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(n[e]))+"\n";for(t+="itemsRemoved:\n",e=0;e<this.itemsRemoved.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(this.itemsRemoved[e]))+"\n";for(t+="columns:\n",e=0;e<this._columns.length;e++)t=t+(e+1)+". "+JSON.stringify(ko.toJS(this._columns[e]))+"\n";return t}t=t||{hasDeleteButton:!0};var s={items:ko.observableArray(),itemsRemoved:[],itemsAdded:[],comboBoxItemsSource:{},currentSelectedItem:ko.observable(),previousSelectedItem:{},_rowClicked:function(e,t,n){return n.isSelected(!0),void 0!==e.currentSelectedItem()&&e.currentSelectedItem().isSelected(!1),e.previousSelectedItem=ko.unwrap(e.currentSelectedItem),e.currentSelectedItem(n),i("datagrid selected index: "+t+"item: "+JSON.stringify(ko.toJS(n))),!0},addCustomFilters:l,_customFilter:[],addColumn:d,_columns:[],enablePaging:ko.observable(!0),paging:u(),buttons:[{text:"+",action:function(e){for(var t={},i=1;i<e._columns.length;i++){var o=ko.unwrap(e._columns[i].filterValue);void 0===o&&(o=e._columns[i].defaultValue),t[e._columns[i].cellValueProperty]=ko.observable(o),n(e._columns[i].cellValueProperty+" default value: "+o)}t.isSelected=ko.observable(!1),e.items.push(t),e.itemsAdded.push(t)}},{text:"&#x1f4be;",action:r},{text:"&#8635;",action:o}],_dataProvider:e,_isSkipLoadFunction:!1,load:o,toString:c};return t.hasDeleteButton===!0&&s._columns.push({headerText:"",type:"action",text:"&#xd7;",readOnly:!0,filterValue:ko.observable(),action:function(e,t){if("filter"===t){e._isSkipLoadFunction=!0;for(var n=0;n<e._columns.length;n++)e._columns[n].filterValue(void 0);e._isSkipLoadFunction=!1,e.load(e)}else e.itemsRemoved.push(t),e.items.remove(t)}}),s.paging.currentPageIndex.subscribe(function(){s.load(s)}),s}function t(e,t,n){function i(){var e,t;return e=window.huypq.control.utilsDOM.createElement("div",{},"foreach: _customFilter",void 0,"gridCustomFilter"),t=m(),c(e,t,"value:filterValue","span","input",{}),t=m(),c(e,t,"value:filterValue","textBox","input",{}),t=m(),c(e,t,"checked:filterValue","checkBox","input",{type:"checkbox"}),t=m(),c(e,t,"cbSelectedValue: filterValue, cbItems: $parents[0].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),t=m(),c(e,t,"datepicker:filterValue","date","input",{}),t=m(),u(e,t,"html:text, click: function(data, event) { action($parents[0], 'filter', data, event) }","action","button",{}),t=window.huypq.control.utilsDOM.createElement("div",{},"template: {name: filterTemplate}",void 0,"customFilterCell"),e.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),e.appendChild(t),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),e}function o(){var e=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridHeader"),t=window.huypq.control.utilsDOM.createComment("ko foreach: _columns"),n=window.huypq.control.utilsDOM.createElement("div",{},"css: 'col'+($index()+1)",void 0,"cell"),i=window.huypq.control.utilsDOM.createElement("span",{},"text: headerText"),o=window.huypq.control.utilsDOM.createComment("/ko");return e.appendChild(t),e.appendChild(n),n.appendChild(i),e.appendChild(o),e}function a(){var e,t;return e=window.huypq.control.utilsDOM.createElement("div",{},"foreach: _columns",void 0,"gridColumnFilter"),t=p(),c(e,t,"value:filterValue","span","input",{}),t=p(),c(e,t,"value:filterValue","textBox","input",{}),t=p(),c(e,t,"checked:filterValue","checkBox","input",{type:"checkbox"}),t=p(),c(e,t,"cbSelectedValue: filterValue, cbItems: $parents[0].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),t=p(),c(e,t,"datepicker:filterValue","date","input",{}),t=p(),u(e,t,"html:text, click: function(data, event) { action($parents[0], 'filter', data, event) }","action","button",{}),t=window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' columnFilter', template: {name: filterTemplate}",void 0,"cell"),e.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),e.appendChild(t),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),e}function r(e){var t=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridBody"),n=window.huypq.control.utilsDOM.createComment(" ko foreach: items "),i=window.huypq.control.utilsDOM.createComment(" /ko ");return t.appendChild(n),t.appendChild(d(e)),t.appendChild(i),t}function l(){var e=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"gridBottomToolbar"),t=window.huypq.control.utilsDOM.createComment("ko with: paging"),n=window.huypq.control.utilsDOM.createElement("input",{type:"checkbox"},"checked: $parent.enablePaging",void 0,void 0),i=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x21e4;', enable: $parent.enablePaging, click: function(data, event){first($parents[0], data, event)}"),o=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x21e5;', enable: $parent.enablePaging, click: function(data, event){last($parents[0], data, event)}"),a=window.huypq.control.utilsDOM.createElement("input",{size:2},"enable: $parent.enablePaging, value: currentPageIndex",void 0,void 0),r=window.huypq.control.utilsDOM.createElement("span",{},"text:'/'+pageCount()",void 0,void 0),l=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x2190;', enable: $parent.enablePaging, click: function(data, event){prev($parents[0], data, event)}"),d=window.huypq.control.utilsDOM.createElement("button",{},"html: '&#x2192;', enable: $parent.enablePaging, click: function(data, event){next($parents[0], data, event)}"),u=window.huypq.control.utilsDOM.createComment("/ko"),c=window.huypq.control.utilsDOM.createComment("ko foreach:buttons"),s=window.huypq.control.utilsDOM.createElement("button",{},"html:text, click: function(data, event){action($parents[0], data, event)}"),p=window.huypq.control.utilsDOM.createComment("/ko");return e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(a),e.appendChild(r),e.appendChild(l),e.appendChild(d),e.appendChild(u),e.appendChild(c),e.appendChild(s),e.appendChild(p),e}function d(e){var t,n;return t="row"===e?window.huypq.control.utilsDOM.createElement("div",{},"click: function(data, event){return $parents[0]._rowClicked($parents[0], $index(), data, event)}, foreach: $parent._columns, css: css() + ' ' + (isSelected()?' selected':'')",void 0,"row"):window.huypq.control.utilsDOM.createElement("div",{},"click: function(data, event){return $parents[0]._rowClicked($parents[0], $index(), data, event)}, foreach: $parent._columns, css: (isSelected()?' selected':'')",void 0,"row"),n=s(),u(t,n,"text:$parent[cellValueProperty]","span","span",{}),n=s(),u(t,n,"textInput:$parent[cellValueProperty], disable:readOnly","textBox","input",{}),n=s(),u(t,n,"checked:$parent[cellValueProperty], disable:readOnly","checkBox","input",{type:"checkbox"}),n=s(),u(t,n,"cbSelectedValue: $parent[cellValueProperty], cbItems: $parents[1].comboBoxItemsSource[itemsSourceName], cbItemText: itemText, cbItemValue: itemValue","comboBox","div",{}),n=s(),u(t,n,"datepicker:$parent[cellValueProperty], disable:readOnly","date","input",{}),n=s(),u(t,n,"html:text, click: function(data, event) { action($parents[1], $parent, data, event) }","action","button",{}),n=window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1), template: {name: cellTemplate}",void 0,"cell"),t.appendChild(window.huypq.control.utilsDOM.createComment("ko if:type==='template'")),t.appendChild(n),t.appendChild(window.huypq.control.utilsDOM.createComment("/ko")),t}function u(e,t,n,i,o,a){var r=window.huypq.control.utilsDOM.createElement(o,a,n),l="ko if:type==='{0}'";e.appendChild(window.huypq.control.utilsDOM.createComment(l.replace("{0}",i))),e.appendChild(t),t.appendChild(r),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko"))}function c(e,t,n,i,o,a){var r=window.huypq.control.utilsDOM.createElement(o,a,n),l="ko if:type==='{0}'";e.appendChild(window.huypq.control.utilsDOM.createComment(l.replace("{0}",i)));var d=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-wrapper"),u=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-button-wrapper"),c=window.huypq.control.utilsDOM.createElement("div",{},void 0,void 0,"h-input-wrapper"),s=window.huypq.control.utilsDOM.createElement("button",{},"click: function(data, event) { data.filterValue(undefined); }","x");u.appendChild(s),c.appendChild(r),d.appendChild(u),d.appendChild(c),e.appendChild(t),t.appendChild(d),e.appendChild(window.huypq.control.utilsDOM.createComment("/ko"))}function s(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + (readOnly?' readonly':'')",void 0,"cell")}function p(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' columnFilter'",void 0,"cell")}function m(){return window.huypq.control.utilsDOM.createElement("div",{},"css:'col'+($index()+1) + ' customFilterCell'",void 0,void 0)}t=t||{hasCustomFilter:!1,hasColumnHeader:!0,hasColumnFilter:!0,hasBottomToolbar:!0};var w=window.huypq.control.utilsDOM.createElement("div",{id:e},void 0,void 0,"h-dataGrid");return t.hasCustomFilter===!0&&w.appendChild(i()),t.hasColumnHeader===!0&&w.appendChild(o()),t.hasColumnFilter===!0&&w.appendChild(a()),w.appendChild(r(n)),t.hasBottomToolbar===!0&&w.appendChild(l()),w}var n=window.huypq.log||function(e){},i=console.log,o={createView:t,createViewModel:e};return o}(),window.app={},window.app.dataProvider={},window.app.view={},window.app.viewModel={},window.app.webApi=function(){function e(e,t){return"http://localhost:5000/"+e+"/"+t}function t(t){return e(t,"get")}function n(e,n){var o=t(e);n=n||{};var d=JSON.stringify(n),u=new $.Deferred,c=e+"_"+d;a("webApi cacheKey: "+c);var s=l._cache[c],p=0,m=0;return void 0!==s&&(p=s.versionNumber,m=s.serverStartTime,d=d.length<3?'{"versionNumber":'+p+',"serverStartTime":'+m+"}":'{"versionNumber":'+p+',"serverStartTime":'+m+","+d.substr(1)),i(o,d).done(function(t,n,i){p===t.versionNumber&&m===t.serverStartTime?(r("webApi cache hit "+e+"   "+p),u.resolve(JSON.parse(s.jsonStringData),s.textStatus,s.jqXHR)):(r("webApi cache miss "+e+"   "+t.versionNumber),l._cache[c]={serverStartTime:t.serverStartTime,versionNumber:t.versionNumber,jsonStringData:JSON.stringify(t),textStatus:n,jqXHR:i},u.resolve(t,n,i))}).fail(function(e){u.reject(e)}),u}function i(e,t){r("webApi postJson: "+e+" "+t);var n={dataType:"json",contentType:"application/json",cache:!1,type:"post",data:t},i=window.localStorage.getItem(window.tokenKey);return i&&(n.headers={token:i}),$.ajax(e,n)}function o(e,t){r("webApi postParams: "+e+" "+JSON.stringify(t));var n={dataType:"json",contentType:"application/x-www-form-urlencoded",cache:!1,type:"post",data:t},i=window.localStorage.getItem(window.tokenKey);return i&&(n.headers={token:i}),$.ajax(e,n)}var a=window.huypq.log||function(e){},r=console.log,l={user:{register:function(t){return o(e("user","register"),t)},token:function(t){return o(e("user","token"),t)}},getData:n,_cache:{}};return l}(),window.app.referenceDataManager=function(e){var t=(window.huypq.log||function(e){},console.log),n={_cache:{}};return n.get=function(i,o){var a=new $.Deferred,r=n._cache[i];return void 0!==r?(t("referenceDataManager cache hit: "+i),a.resolve(r.data,r.textStatus,r.jqXHR)):e.getData(i,o).done(function(e,o,r){t("referenceDataManager cache miss: "+i),n._cache[i]={data:e,textStatus:o,jqXHR:r},a.resolve(e,o,r)}).fail(function(e){a.reject(e)}),a},n}(window.app.webApi),window.app.dataProvider.tonKhoDataProvider=function(e,t){function n(n,i,o){n.orderOptions=[{propertyPath:"MaMatHangNavigation.TenMatHangDayDu",isAscending:!0}],n.pageIndex=0,$.when(e.getData("ttonKho",n),t.get("rloaiHang",{orderOptions:[{propertyPath:"TenLoai",isAscending:!0}]}),t.get("tmatHang"),t.get("rkhoHang",{orderOptions:[{propertyPath:"TenKho",isAscending:!0}]}),t.get("rcanhBaoTonKho")).done(function(e,t,n,o,a){for(var r={},l=a[0].items,d=0;d<l.length;d++)r[l[d].maKhoHang]=r[l[d].maKhoHang]||{},r[l[d].maKhoHang][l[d].maMatHang]={tonCaoNhat:l[d].tonCaoNhat,tonThapNhat:l[d].tonThapNhat};for(var u={},c=n[0].items,d=0;d<c.length;d++)u[c[d].ma]=c[d].tenMatHangDayDu;for(var s={items:[],totalItemCount:e[0].TotalItemCount,pageIndex:e[0].PageIndex,pageCount:e[0].PageCount},p=e[0].items,d=0;d<p.length;d++){var m=p[d],w="";if(void 0!==r[m.maKhoHang]&&void 0!==r[m.maKhoHang][m.maMatHang]){var h=r[m.maKhoHang][m.maMatHang],v=m.soLuong;if(0==v&&0==h.tonThapNhat)continue;v<h.tonThapNhat?w="warningLower":v>h.tonCaoNhat&&(w="warningUpper")}s.items.push({tenMatHang:ko.observable(u[m.maMatHang]),soLuong:ko.observable(m.soLuong),css:ko.observable(w)})}s.comboBoxItemsSource={},s.comboBoxItemsSource.loaiHangs=t[0].items,s.comboBoxItemsSource.khoHangs=o[0].items,i(s)}).fail(o)}var i={_items:[],getItemsAjax:n};return i}(window.app.webApi,window.app.referenceDataManager),window.app.viewModel.loginViewModel=function(e){function t(){var t={email:ko.observable("huy"),password:ko.observable("nobita"),group:ko.observable("vinhphat"),signInAction:function(t){e.user.token({user:t.email(),pass:t.password(),group:t.group()}).done(function(e){window.localStorage.setItem(window.tokenKey,e),window.app.view.mainView.show(),window.app.view.viewManager.loadCurrentView()}).fail(function(e){console.log("fail: "+JSON.stringify(e))})},registerAction:function(t){e.user.register({user:t.email(),password:t.password()}).done(function(e){console.log(e)}).fail(function(e){console.log(e)})}};return t}var n={create:t};return n}(window.app.webApi),window.app.viewModel.tonKhoViewModel=function(){var e=huypq.control.dataGrid.createViewModel(window.app.dataProvider.tonKhoDataProvider,{hasDeleteButton:!1});e.addColumn({headerText:"",type:"span",cellValueProperty:"tenMatHang",readOnly:!1,order:0,filterValue:ko.observable()}),e.addColumn({headerText:"",type:"span",cellValueProperty:"soLuong",readOnly:!1,order:0,filterValue:ko.observable()});var t={tk:1,d:huypq.dateTimeUtils.getCurrentDate(),ml:1},n={type:"comboBox",propertyPath:"MaKhoHang",itemsSourceName:"khoHangs",itemText:"tenKho",itemValue:"ma",filterValue:ko.observable(t.tk),whereType:"QueryBuilder.WhereExpression+WhereOptionInt, QueryBuilder"},i={type:"date",propertyPath:"Ngay",filterValue:ko.observable(t.d),whereType:"QueryBuilder.WhereExpression+WhereOptionDate, QueryBuilder"},o={type:"comboBox",propertyPath:"MaMatHangNavigation.MaLoai",itemsSourceName:"loaiHangs",itemText:"tenLoai",itemValue:"ma",filterValue:ko.observable(t.ml),whereType:"QueryBuilder.WhereExpression+WhereOptionInt, QueryBuilder"};return e.addCustomFilters([n,i,o]),e.init=function(){e.initialized!==!0&&(e.initialized=!0,e.load(e))},e}(),window.app.view.viewManager=function(){function e(){var e=window.app.view[a._currentViewName](a._currentViewName);$(a._mainContentId).append(e),ko.applyBindings(a._currentViewModel,e)}function t(t){if(void 0!==window.app.view[a._currentViewName]&&$("#"+a._currentViewName).hide(),a._currentViewName=t,o("viewManager currentViewName: "+a._currentViewName),void 0===window.app.view[a._currentViewName])throw new Error("View not exist: "+a._currentViewName);a._currentViewModel=window.app.viewModel[a._currentViewName+"Model"],(void 0===a._currentViewModel.initialized||a._currentViewModel.initialized===!1)&&(e(),a._currentViewModel.init()),$("#"+a._currentViewName).show(),a._isSkipPushState===!1&&(window.history.pushState({selectedView:t},"","?v="+t),i("pushState: "+JSON.stringify(t)))}function n(e,t){for(var n=-1,i=0;i<t.length;i++){var o=t[i];if(o.value===e){n=i;break}}return n}var i=window.huypq.log||function(e){},o=console.log,a={_headerMenuViewModel:{},_currentViewName:"",_currentViewModel:{},_mainContentId:"",_isSkipPushState:!1};return a.init=function(e,n,o){this._headerMenuViewModel=o,this._mainContentId=n,$(e).append(window.huypq.control.headerMenu.createView("headerMenuView",o)),o.selectedItemValue.subscribe(t),window.onpopstate=function(e){a.setCurrentView(e.state.selectedView),i("onpopstate: "+JSON.stringify(e.state))}},a.setCurrentView=function(e){var t=n(e,this._headerMenuViewModel.items);0>t||(this._isSkipPushState=!0,this._headerMenuViewModel.selectedItemText(this._headerMenuViewModel.items[t].text),this._headerMenuViewModel.selectedItemValue(this._headerMenuViewModel.items[t].value),this._isSkipPushState=!1)},a.loadCurrentView=function(){a._currentViewModel.load(a._currentViewModel)},a}(),window.app.view.mainView=function(e){function t(){$("#mainView").show(),$("#loginView").hide()}function n(){var t={items:[{text:"Ton kho",value:"tonKhoView",id:""}],selectedItemText:ko.observable(),selectedItemValue:ko.observable(),buttons:[{text:"",id:"refreshButton",action:function(){e.loadCurrentView()}},{text:"&#x2716;",id:"exitButton",action:function(){window.localStorage.removeItem(window.tokenKey),window.app.view.loginView.show()}}]};e.init("#headerContent","#mainContent",t);var n=window.params.v||"tonKhoView";e.setCurrentView(n)}var i={show:t,init:n};return i}(window.app.view.viewManager),window.app.view.loginView=function(e){function t(){$("#loginView").show(),$("#mainView").hide()}function n(){i("#loginView");var e=window.app.viewModel.loginViewModel.create();ko.applyBindings(e,$("#loginView")[0])}function i(t){$(t).append(e.createElement("input",{type:"text",placeholder:"Email"},"textInput: email")),$(t).append(e.createElement("input",{type:"password",placeholder:"Password"},"textInput: password")),$(t).append(e.createElement("input",{type:"text",placeholder:"Group"},"textInput: group")),$(t).append(e.createElement("button",{},"click: signInAction","Sign in")),$(t).append(e.createElement("button",{},"click: registerAction","Register"))}var o={show:t,init:n};return o}(window.huypq.control.utilsDOM),window.app.view.tonKhoView=function(){return function(e){var t=window.huypq.control.dataGrid.createView(e,{hasCustomFilter:!0,hasColumnHeader:!1,hasColumnFilter:!1,hasBottomToolbar:!1},"row");return t}}(),function(){{var e=window.huypq.log||function(e){};console.log}$("body").append('<div id="loginView"></div>','<div id="mainView"></div>'),$("#mainView").append('<div id="headerContent"></div>','<div id="mainContent"></div>'),window.tokenKey="accessToken";var t=window.localStorage.getItem(window.tokenKey);e("app token: "+t),window.app.view.mainView.init(),window.app.view.loginView.init(),t?window.app.view.mainView.show():window.app.view.loginView.show()}();